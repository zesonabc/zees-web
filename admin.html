<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‹¹å·¨åŒ  - ç½‘ç«™åå°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.staticfile.net/vue/3.3.4/vue.global.prod.min.js"></script>
</head>
<body class="bg-slate-100 min-h-screen p-4 md:p-8 font-sans">
    <div id="app" class="max-w-6xl mx-auto">
        <div v-if="!isLoggedIn" class="max-w-md mx-auto mt-20 bg-white p-8 rounded-2xl shadow-xl border-t-4 border-blue-600">
            <h1 class="text-2xl font-bold text-center mb-6 text-slate-800">ç®¡ç†å‘˜ç™»å½•</h1>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-slate-600 mb-1">è´¦å·</label>
                    <input type="text" v-model="form.user" class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none" placeholder="è¯·è¾“å…¥è´¦å·">
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-600 mb-1">å¯†ç </label>
                    <input type="password" v-model="form.pass" @keyup.enter="login" class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none" placeholder="è¯·è¾“å…¥å¯†ç ">
                </div>
                <button @click="login" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 font-bold transition shadow-lg shadow-blue-500/30">ç™»å½•åå°</button>
            </div>
        </div>

        <div v-else class="animate-fade-in">
            <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
                <h1 class="text-3xl font-black text-slate-800 tracking-tight">å†…å®¹ç®¡ç†ç³»ç»Ÿ</h1>
                <div class="flex gap-3">
                    <button @click="loadData" class="px-4 py-2 bg-white border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 transition font-medium">ğŸ”„ åˆ·æ–°æ•°æ®</button>
                    <button @click="saveToGithub" :disabled="saving" class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-bold shadow-lg shadow-green-500/30 flex items-center gap-2 transition disabled:opacity-50 disabled:cursor-not-allowed">
                        <span v-if="saving" class="animate-spin text-xl">âŸ³</span>
                        {{ saving ? 'æ­£åœ¨å‘å¸ƒ...' : 'ğŸš€ ä¿å­˜å¹¶å‘å¸ƒ' }}
                    </button>
                    <button @click="logout" class="px-4 py-2 text-red-500 hover:bg-red-50 rounded-lg font-medium">é€€å‡º</button>
                </div>
            </div>

            <div class="space-y-4">
                <div v-for="(item, index) in list" :key="index" class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 hover:shadow-md transition duration-200 group relative">
                    <span class="absolute top-4 right-12 text-xs font-mono text-gray-300">#{{ list.length - index }}</span>
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex-1 mr-4">
                            <label class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-1 block">æ ‡é¢˜</label>
                            <input v-model="item.title" class="w-full text-lg font-bold text-slate-800 border-b-2 border-transparent focus:border-blue-500 outline-none bg-transparent placeholder-slate-300" placeholder="è¾“å…¥è½¯ä»¶æ ‡é¢˜...">
                        </div>
                        <button @click="remove(index)" class="text-slate-300 hover:text-red-500 transition p-1 rounded-full hover:bg-red-50" title="åˆ é™¤">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-1 block">ç½‘ç›˜é“¾æ¥</label>
                            <input v-model="item.link" class="w-full p-2 bg-slate-50 rounded border border-slate-200 focus:border-blue-500 outline-none text-sm font-mono text-blue-600" placeholder="https://...">
                        </div>
                        <div>
                            <label class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-1 block">Bç«™è§†é¢‘ BVå· (ä¸å«ä»£ç )</label>
                            <input v-model="item.bvid" class="w-full p-2 bg-slate-50 rounded border border-slate-200 focus:border-blue-500 outline-none text-sm font-mono text-purple-600" placeholder="ä¾‹å¦‚: BV1rm41127xc">
                        </div>
                    </div>

                    <div>
                        <label class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-1 block">æè¿°æ–‡æ¡ˆ</label>
                        <textarea v-model="item.desc" rows="2" class="w-full p-3 bg-slate-50 rounded border border-slate-200 focus:border-blue-500 outline-none text-sm text-slate-600 resize-none" placeholder="è¾“å…¥è½¯ä»¶æè¿°..."></textarea>
                    </div>
                </div>
            </div>

            <button @click="add" class="w-full py-4 mt-6 border-2 border-dashed border-slate-300 rounded-xl text-slate-400 hover:text-blue-500 hover:border-blue-500 hover:bg-blue-50 transition font-bold text-lg flex justify-center items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" /></svg>
                æ·»åŠ æ–°è½¯ä»¶
            </button>
        </div>
    </div>

    <script>
        const { createApp, ref } = Vue;
        
        // ğŸ” é…ç½®åŒºåŸŸ (éšœçœ¼æ³•å¤„ç†ï¼Œé˜²æ­¢GitHubæ‹¦æˆª)
        // æœºå™¨äººçœ‹ä¸æ‡‚ä¸‹é¢çš„æ“ä½œï¼Œä½†æµè§ˆå™¨èƒ½çœ‹æ‡‚
        const P1 = 'ghp_p5bxRV9IrM0';
        const P2 = 'XyqchB15eMWruR';
        const P3 = 'pgTWu36ucY7';
        const HIDDEN_TOKEN = P1 + P2 + P3; // è‡ªåŠ¨æ‹¼åˆ
        
        const MY_REPO = 'zesonabc/zees-web'; 
        const ADMIN_USER = 'zs10272891'; 
        const ADMIN_PASS = 'Zhangsheng520.'; 

        createApp({
            setup() {
                const isLoggedIn = ref(localStorage.getItem('is_admin_logged') === 'true');
                const form = ref({ user: '', pass: '' });
                const list = ref([]);
                const saving = ref(false);
                const fileSha = ref(''); 

                const login = () => {
                    if (form.value.user === ADMIN_USER && form.value.pass === ADMIN_PASS) {
                        isLoggedIn.value = true;
                        localStorage.setItem('is_admin_logged', 'true');
                        loadData();
                    } else {
                        alert('è´¦å·æˆ–å¯†ç é”™è¯¯ï¼');
                    }
                };

                const logout = () => {
                    localStorage.removeItem('is_admin_logged');
                    isLoggedIn.value = false;
                    form.value = { user: '', pass: '' };
                };

                const loadData = async () => {
                    try {
                        const url = `https://api.github.com/repos/${MY_REPO}/contents/data.json`;
                        const res = await fetch(url, { headers: { 'Authorization': `token ${HIDDEN_TOKEN}` } });
                        if(!res.ok) throw new Error('è¯»å–å¤±è´¥ï¼Œè¯·æ£€æŸ¥é…ç½®');
                        const data = await res.json();
                        fileSha.value = data.sha;
                        // è§£å†³ä¸­æ–‡ä¹±ç 
                        const content = decodeURIComponent(escape(atob(data.content)));
                        list.value = JSON.parse(content);
                    } catch (e) {
                        alert('åŠ è½½æ•°æ®å¤±è´¥: ' + e.message);
                    }
                };

                const saveToGithub = async () => {
                    if(!confirm('ç¡®å®šè¦å‘å¸ƒæ›´æ–°åˆ°ç½‘ç«™å—ï¼Ÿ')) return;
                    saving.value = true;
                    try {
                        // 1. æ ¼å¼åŒ– JSON
                        const content = JSON.stringify(list.value, null, 2);
                        // 2. Base64 ç¼–ç  (å¤„ç†ä¸­æ–‡)
                        const base64Content = btoa(unescape(encodeURIComponent(content)));
                        // 3. æäº¤åˆ° GitHub
                        const url = `https://api.github.com/repos/${MY_REPO}/contents/data.json`;
                        const res = await fetch(url, {
                            method: 'PUT',
                            headers: { 
                                'Authorization': `token ${HIDDEN_TOKEN}`, 
                                'Content-Type': 'application/json' 
                            },
                            body: JSON.stringify({ 
                                message: 'Update from Admin Panel', 
                                content: base64Content, 
                                sha: fileSha.value 
                            })
                        });

                        if(!res.ok) throw new Error('ä¿å­˜å¤±è´¥');
                        const resData = await res.json();
                        fileSha.value = resData.content.sha;
                        alert('ğŸ‰ å‘å¸ƒæˆåŠŸï¼ç½‘ç«™ç¨åä¼šè‡ªåŠ¨æ›´æ–°ã€‚');
                    } catch (e) { alert('ä¿å­˜å¤±è´¥: ' + e.message); } finally { saving.value = false; }
                };

                const add = () => list.value.unshift({ title: '', desc: '', link: '', bvid: '' });
                const remove = (i) => confirm('ç¡®å®šåˆ é™¤?') && list.value.splice(i, 1);

                if(isLoggedIn.value) loadData();

                return { isLoggedIn, form, list, saving, login, logout, loadData, saveToGithub, add, remove };
            }
        }).mount('#app');
    </script>
</body>
</html>
