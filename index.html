<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer" />
    <title>苹巨匠科技</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script>
      // 配置 Tailwind
      tailwind.config = { theme: { extend: { colors: { slate: { 850: '#151e32' } } } } }
    </script>
    <style>
      /* 2. 强制兜底样式：防止网络卡顿时图片变大 */
      body { 
          background: #0f172a; 
          color: #f1f5f9; 
          font-family: sans-serif;
      }
      /* 只要加上这个，二维码永远不会变巨大 */
      .safe-img { width: 100%; height: 100%; object-fit: cover; }
      .qr-box { width: 120px; height: 120px; overflow: hidden; border-radius: 8px; margin: 0 auto; }
    </style>
</head>
<body class="antialiased">
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        const DATA_URL = "./data.json"; 

        const extractBV = (input) => {
            if (!input) return null;
            const match = input.match(/(BV[a-zA-Z0-9]+)/);
            return match ? match[1] : input;
        };

        // 图标组件 (强制限制大小)
        const Icon = ({ children, size = 20, ...p }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p} style={{minWidth: size, minHeight: size}}>
                {children}
            </svg>
        );

        // 简化的图标
        const Play = (p) => <Icon {...p}><polygon points="5 3 19 12 5 21 5 3"/></Icon>;
        const Download = (p) => <Icon {...p}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></Icon>;
        const SearchIcon = (p) => <Icon {...p}><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></Icon>;

        const Card = ({ item }) => {
            const [isPlaying, setIsPlaying] = useState(false);
            const [copied, setCopied] = useState(false);
            
            const copyCode = () => {
                navigator.clipboard.writeText('sudo spctl --master-disable');
                setCopied(true);
                setTimeout(() => setCopied(false), 2000);
            };

            const bv = extractBV(item.bvid || '');
            const videoUrl = bv ? `//player.bilibili.com/player.html?bvid=${bv}&page=1&high_quality=1&danmaku=0&autoplay=1` : '';

            return (
                <div className="bg-slate-900/80 border border-white/10 rounded-xl overflow-hidden mb-6 flex flex-col md:flex-row shadow-lg">
                    {/* 左边：视频区 */}
                    <div className="md:w-7/12 p-4">
                        <div className="flex items-center gap-2 mb-3 font-bold text-lg text-white truncate">
                            <span className="w-1 h-5 bg-blue-500 rounded-full"></span>
                            {item.title}
                        </div>
                        <div className="aspect-video bg-black rounded-lg overflow-hidden relative border border-white/10">
                            {bv ? (
                                isPlaying ? (
                                    <iframe src={videoUrl} className="w-full h-full" frameBorder="0" allowFullScreen allow="autoplay"></iframe>
                                ) : (
                                    <div className="absolute inset-0 flex flex-col items-center justify-center cursor-pointer bg-slate-800 hover:bg-slate-700 transition" onClick={() => setIsPlaying(true)}>
                                        <div className="w-14 h-14 bg-blue-600 rounded-full flex items-center justify-center shadow-lg mb-2">
                                            <Play size={28} className="ml-1 text-white fill-white" />
                                        </div>
                                        <span className="text-xs text-slate-300 bg-black/50 px-2 py-1 rounded">点击播放预览</span>
                                    </div>
                                )
                            ) : <div className="absolute inset-0 flex items-center justify-center text-slate-500 text-sm">暂无预览视频</div>}
                        </div>
                        {item.link && (
                            <a href={item.link} target="_blank" className="mt-4 block w-full bg-blue-600 hover:bg-blue-500 text-white text-center py-3 rounded-lg font-bold transition flex items-center justify-center gap-2">
                                <Download size={18} /> 下载网盘资源
                            </a>
                        )}
                    </div>

                    {/* 右边：信息区 (带防弹样式的二维码) */}
                    <div className="md:w-5/12 bg-black/20 p-4 border-l border-white/5 flex flex-col">
                        <div className="bg-black/40 p-3 rounded-lg border border-white/10 mb-4 cursor-pointer" onClick={copyCode}>
                            <div className="flex justify-between text-xs text-slate-400 mb-1">
                                <span>开启命令 (点击复制):</span>
                                {copied && <span className="text-green-400">已复制!</span>}
                            </div>
                            <code className="text-green-400 font-mono text-xs break-all">sudo spctl --master-disable</code>
                        </div>
                        
                        <div className="flex-1 text-slate-300 text-sm mb-4 overflow-y-auto max-h-32 whitespace-pre-line">
                            {item.desc || item.title}
                        </div>

                        {/* 底部二维码 (加了 safe-img 锁死大小) */}
                        <div className="grid grid-cols-2 gap-3 mt-auto pt-3 border-t border-white/10">
                            <div className="text-center bg-black/30 p-2 rounded-lg">
                                <div className="qr-box">
                                    <img src="./wx.jpg" alt="WeChat" className="safe-img" />
                                </div>
                                <p className="text-[10px] text-amber-400 mt-1 font-bold">远程安装 ¥15</p>
                            </div>
                            <div className="text-center bg-black/30 p-2 rounded-lg">
                                <div className="qr-box">
                                    <img src="./pay.jpg" alt="Pay" className="safe-img" />
                                </div>
                                <p className="text-[10px] text-pink-400 mt-1 font-bold">打赏博主</p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [query, setQuery] = useState('');
            const [list, setList] = useState([]);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                fetch(DATA_URL + '?t=' + Date.now()).then(r => r.json()).then(d => {
                    setList(d); setLoading(false);
                }).catch(() => setLoading(false));
            }, []);

            const filtered = useMemo(() => list.filter(i => !query || JSON.stringify(i).toLowerCase().includes(query.toLowerCase())), [query, list]);

            return (
                <div className="max-w-5xl mx-auto px-4 py-8 min-h-screen pb-20">
                    <div className="text-center mb-8">
                        <h1 className="text-3xl md:text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500 mb-2">苹巨匠科技</h1>
                        <p className="text-slate-400 text-sm">Mac 生产力工具 · 详细安装教程</p>
                    </div>

                    <div className="relative max-w-xl mx-auto mb-10">
                        <input type="text" value={query} onChange={e => setQuery(e.target.value)} 
                            className="w-full bg-slate-800/80 border border-slate-600 rounded-full py-3 pl-12 pr-4 text-white focus:outline-none focus:border-blue-500 transition"
                            placeholder="搜索软件..." />
                        <SearchIcon className="absolute left-4 top-3.5 text-slate-400" size={20} />
                    </div>

                    {loading ? <div className="text-center text-slate-500">正在加载...</div> : 
                        filtered.map((item, i) => <Card key={i} item={item} />)
                    }
                    
                    {!loading && filtered.length === 0 && <div className="text-center text-slate-500 mt-10">未找到相关软件</div>}
                    
                    <footer className="mt-12 text-center text-slate-600 text-xs">© 2025 苹巨匠科技</footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
